<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gapi.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gapi.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';
/**
 * Handles Google API interactions.
 *
 * @module gapi
 * @author Malte311
 */

/**
 * Searches for a given user input.
 */
function search() {
	let $searchInput = $('#search-input').val();
	let params = `?part=snippet&amp;maxResults=12&amp;type=channel&amp;q=${$searchInput}&amp;key=${config.apiKey}`;

	sendApiRequest('GET', API_BASE_URL + '/search' + params, response => {
		$('#search-results').html('');
		let items = JSON.parse(response).items;
		for (let channel of items) {
			displaySearchResultCard(
				'search-results', 
				channel.id.channelId, 
				channel.snippet.thumbnails.medium.url, 
				channel.snippet.channelTitle, 
				channel.snippet.description
			);
		}

		if (!items.length)
			displayAlert('search-results', 'No results found.', 'danger');
	});
}

/**
 * Returns a list of new videos for a given channel.
 * 
 * @param {string} channelId The id of the channel for which we want to get the newest videos.
 * @param {number} startTime Timestamp which determines from when on videos are new.
 * @param {function} callback Callback containing the result as a parameter.
 * @param {string} [pageToken] Token for a specific page of the search results.
 * @param {number} [maxRes] Amount of maximum search results, defaults to 50.
 */
function getVideos(channelId, startTime, callback, pageToken = '', maxRes = 50) {
	let params = `?part=snippet&amp;type=video&amp;channelId=${channelId}&amp;maxResults=${maxRes}&amp;order=date`;
	if (startTime != undefined)
		params += `&amp;publishedAfter=${new Date(startTime).toISOString()}`;

	if (pageToken.length)
		params += `&amp;pageToken=${pageToken}`;

	params += `&amp;key=${config.apiKey}`;
	
	sendApiRequest('GET', API_BASE_URL + '/search' + params, response => {
		callback(response);
	});
}

/**
 * Finds out the title of a given video.
 * @param {string} videoUrl The url for the video.
 * @param {function} callback Callback containing the title as a parameter.
 */
function getVideoTitle(videoUrl, callback) {
	let videoId = videoUrl.split('?v=')[1];
	let params = `?part=snippet&amp;id=${videoId}&amp;key=${config.apiKey}`;
	sendApiRequest('GET', API_BASE_URL + '/videos' + params, response => {
		callback(JSON.parse(response).items[0].snippet.title);
	});
}

/**
 * Sends a request to the google API.
 * 
 * @param {DOMString} method The HTTP method, e.g. GET, POST, PUT, DELETE.
 * @param {DOMString} url The url to which the request should be send.
 * @param {function} callback Callback function which receives the response as a parameter.
 */
function sendApiRequest(method, url, callback) {
	let xmlHttp = new XMLHttpRequest();
	xmlHttp.open(method, url);
	xmlHttp.addEventListener('load', event => {
		if (xmlHttp.status >= 200 &amp;&amp; xmlHttp.status &lt; 300)
			callback(xmlHttp.responseText);

		if (xmlHttp.status >= 400) {
			let msg = 'Either your API key is not valid or your quota is exceeded!';
			createDialog('show-dialog', 'Error', msg, undefined, true);
			enableDownloadButtons();
		}
	});

	xmlHttp.send();
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-channel.html">channel</a></li><li><a href="module-config.html">config</a></li><li><a href="module-display.html">display</a></li><li><a href="module-electronMenu.html">electronMenu</a></li><li><a href="module-gapi.html">gapi</a></li><li><a href="module-globals.html">globals</a></li><li><a href="module-load.html">load</a></li><li><a href="module-main.html">main</a></li><li><a href="module-updates.html">updates</a></li><li><a href="module-util.html">util</a></li><li><a href="module-videos.html">videos</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sat Jan 16 2021 16:22:57 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
